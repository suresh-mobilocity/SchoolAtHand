function Controller(){function e(e){var t=[],i="SELECT shortname from schools where name = '"+e+"'",o=schoolDB.execute(i),n=null;o.getRowCount()>0&&o.isValidRow()&&(n=o.fieldByName("shortname"),o.close());var r="SELECT strftime('%m/%d', eventdate) as eventdate , strftime('%w', eventdate) as weekday, eventdescription from districtcalendar where schoolcode like '"+n.toUpperCase()+"'  and eventdate between date('now') and date('now', '+7 day') UNION SELECT strftime('%m/%d', eventdate) as eventdate , strftime('%w', eventdate) as weekday, eventdescription from districtcalendar where schoolcode like '' and eventdate between date('now') and date('now', '+7 day') order by 1";Ti.API.info("eventsQuery: "+r);var a=schoolDB.execute(r);if(a.getRowCount()>0){for(;a.isValidRow();){var l=a.fieldByName("eventdate"),s=a.fieldByName("eventdescription"),d=dayNames[a.fieldByName("weekday")],c=Ti.UI.createTableViewRow({height:30,backgroundColor:"#B2FFFF"}),_=Ti.UI.createView({left:5,layout:"horizontal",id:"contactControls",height:Ti.UI.SIZE,width:Ti.UI.SIZE}),u=Ti.UI.createLabel({text:l+" "+d,font:{fontSize:14,fontWeight:"bold"},height:Ti.UI.SIZE,color:"#217346"}),h=Ti.UI.createLabel({left:20,text:s,font:{fontSize:12,fontWeight:"bold"},height:Ti.UI.SIZE,color:"blue"});_.add(u),_.add(h),c.add(_),t.push(c),a.next()}a.close()}return t}function t(){var e="SELECT phonenum, emailaddr FROM contacts where name like '%"+w+"%' AND building like '"+u+"%'";Ti.API.info("contacts: "+e);var t=schoolDB.execute(e);t.getRowCount()>0&&t.isValidRow()&&(s=t.fieldByName("phonenum"),d=t.fieldByName("emailaddr"),Ti.API.info("Teacher: "+w+" phoneno:"+s+" emailaddr:"+d)),t.close()}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="MyDashboard",arguments[0]?arguments[0].__parentSymbol:null,arguments[0]?arguments[0].$model:null,arguments[0]?arguments[0].__itemTemplate:null;var i=this,o={};i.myProfile=Alloy.createModel("profile"),i.__views.MyDashboardWindow=Ti.UI.createWindow({backgroundColor:"white",id:"MyDashboardWindow",title:"Dashboard"}),i.__views.MyDashboardWindow&&i.addTopLevelView(i.__views.MyDashboardWindow),i.__views.mainView=Ti.UI.createView({layout:"vertical",height:"100%",width:Ti.UI.FILL,borderColor:"gray",borderWidth:2,id:"mainView"}),i.__views.MyDashboardWindow.add(i.__views.mainView),i.__views.profileView=Ti.UI.createView({color:"blue",top:"3%",left:"3%",right:"5%",height:Ti.UI.SIZE,width:Ti.UI.SIZE,layout:"horizontal",id:"profileView"}),i.__views.mainView.add(i.__views.profileView),i.__views.profileImage=Ti.UI.createImageView({left:10,width:64,height:64,autorotate:!0,id:"profileImage"}),i.__views.profileView.add(i.__views.profileImage),i.__views.profileDetailsLabel=Ti.UI.createLabel({textAlign:"Ti.UI.TEXT_ALIGNMENT_RIGHT",verticalAlign:"TEXT_VERTICAL_ALIGNMENT_TOP",font:{fontSize:12,fontWeight:"bold"},color:"black",left:50,width:Ti.UI.SIZE,height:Ti.UI.SIZE,id:"profileDetailsLabel"}),i.__views.profileView.add(i.__views.profileDetailsLabel),i.__views.contactTeacher=Ti.UI.createView({backgroundColor:"white",top:2,height:50,width:200,style:"Titanium.UI.iPhone.SystemButtonStyle.BAR",left:120,id:"contactTeacher",layout:"horizontal"}),i.__views.mainView.add(i.__views.contactTeacher),i.__views.callButton=Ti.UI.createLabel({font:{fontFamily:"AppIcons",fontSize:"50dp",fontWeight:"normal"},color:"#336699",backgroundColor:"white",height:"50",width:"50",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,verticalAlign:Ti.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,id:"callButton"}),i.__views.contactTeacher.add(i.__views.callButton),i.__views.emailButton=Ti.UI.createLabel({left:25,backgroundColor:"white",width:50,height:50,color:"#336699",borderRadius:8,font:{fontFamily:"AppIcons",fontSize:"50dp",fontWeight:"normal"},textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,verticalAlign:Ti.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,id:"emailButton"}),i.__views.contactTeacher.add(i.__views.emailButton),i.__views.contentButtonBar=Ti.UI.createView({backgroundColor:"#336699",top:20,height:50,width:Ti.UI.FILL,style:"Titanium.UI.iPhone.SystemButtonStyle.BAR",font:{fontSize:16,fontWeight:"normal"},color:"blue",layout:"horizontal",left:"2%",right:"2%",id:"contentButtonBar"}),i.__views.mainView.add(i.__views.contentButtonBar),i.__views.eventsButton=Ti.UI.createButton({height:50,width:"auto",backgroundColor:"#336699",font:{fontSize:14,fontWeight:"normal"},color:"white",selectedColor:"red",id:"eventsButton",title:"Events"}),i.__views.contentButtonBar.add(i.__views.eventsButton),i.__views.friFolderButton=Ti.UI.createButton({left:10,height:50,width:"auto",backgroundColor:"#336699",font:{fontSize:14,fontWeight:"normal"},color:"white",selectedColor:"red",id:"friFolderButton",title:"Fri.Folder"}),i.__views.contentButtonBar.add(i.__views.friFolderButton),i.__views.lunchButton=Ti.UI.createButton({left:10,height:50,width:"auto",backgroundColor:"#336699",font:{fontSize:14,fontWeight:"normal"},color:"white",selectedColor:"red",id:"lunchButton",title:"Lunch"}),i.__views.contentButtonBar.add(i.__views.lunchButton),i.__views.sportsButton=Ti.UI.createButton({left:10,height:50,width:"auto",backgroundColor:"#336699",font:{fontSize:14,fontWeight:"normal"},color:"white",selectedColor:"red",id:"sportsButton",title:"Sports"}),i.__views.contentButtonBar.add(i.__views.sportsButton),i.__views.contentsScrollView=Ti.UI.createScrollView({layout:"vertical",scrollType:"vertical",showVerticalScrollIndicator:"true",left:"2%",right:"2%",height:150,width:Ti.UI.FILL,borderColor:"gray",contentHeight:"auto",borderWidth:1,borderRadius:8,id:"contentsScrollView"}),i.__views.mainView.add(i.__views.contentsScrollView),i.__views.announcementsScrollView=Ti.UI.createScrollView({layout:"vertical",top:5,left:"2%",right:"2%",height:100,scrollType:"vertical",showVerticalScrollIndicator:"true",width:Ti.UI.FILL,contentHeight:"auto",borderWidth:1,borderColor:"gray",borderRadius:8,id:"announcementsScrollView"}),i.__views.mainView.add(i.__views.announcementsScrollView),i.__views.districtAnnouncementsView=Ti.UI.createView({layout:"vertical",top:0,width:Ti.UI.FILL,borderColor:"gray",borderWidth:1,borderRadius:8,id:"districtAnnouncementsView"}),i.__views.announcementsScrollView.add(i.__views.districtAnnouncementsView),i.__views.districtAnnouncementsLabel=Ti.UI.createLabel({color:"red",left:5,font:{fontSize:12,fontWeight:"normal"},textAlign:"Ti.UI.TEXT_ALIGNMENT_LEFT",verticalAlign:"Ti.UI.TEXT_VERTICAL_ALIGNMENT_TOP",id:"districtAnnouncementsLabel"}),i.__views.districtAnnouncementsView.add(i.__views.districtAnnouncementsLabel),o.destroy=function(){},_.extend(i,i.__views);var n=arguments[0]||{},r=[],a=[],l=[];n.parentTab,n.tabToNavigateBack,n.windowToNavigate;var s=null,d=null,c=n.data,u=c.get("school"),h=c.get("grade"),w=c.get("teacher");i.profileDetailsLabel.text=c.get("name")+"\n"+h+"\n"+u+"\nTeacher: "+w,i.callButton.text=Alloy.Globals.icons.phone,i.emailButton.text=Alloy.Globals.icons.envelope_alt;var p=e(u),v=Ti.UI.createTableViewRow({height:30,backgroundColor:"#B2FFFF"}),f=Ti.UI.createView({left:5,layout:"horizontal",id:"contactControls",height:Ti.UI.SIZE,width:Ti.UI.SIZE}),m=Ti.UI.createLabel({text:"No Records Found",font:{fontSize:14,fontWeight:"bold"},height:Ti.UI.SIZE,color:"#217346"});f.add(m),v.add(f),r.push(v),a.push(v),l.push(v);var g=Titanium.UI.createTableView({data:p}),T=Titanium.UI.createTableView({data:r}),y=Titanium.UI.createTableView({data:a}),b=Titanium.UI.createTableView({data:l});i.eventsButton.color="red",i.contentsScrollView.add(g),i.profileImage.image=c.get("url"),Ti.API.info("URL for the profile:"+c.get("url")),1==profileCollection.length&&(i.MyDashboardWindow.backButtonTitle=""),i.friFolderButton.addEventListener("click",function(){i.contentsScrollView.removeAllChildren(),i.contentsScrollView.add(y),i.eventsButton.color="white",i.sportsButton.color="white",i.friFolderButton="red",i.lunchButton.color="white"}),i.lunchButton.addEventListener("click",function(){i.contentsScrollView.removeAllChildren(),i.contentsScrollView.add(T),i.eventsButton.color="white",i.sportsButton.color="white",i.friFolderButton="white",i.lunchButton.color="red"}),i.sportsButton.addEventListener("click",function(){i.contentsScrollView.removeAllChildren(),i.contentsScrollView.add(b),i.sportsButton.color="red",i.eventsButton.color="white",i.friFolderButton="white",i.lunchButton.color="white"}),i.eventsButton.addEventListener("click",function(){i.contentsScrollView.removeAllChildren(),i.contentsScrollView.add(g),i.eventsButton.color="red",i.sportsButton.color="white",i.friFolderButton="white",i.lunchButton.color="white"}),i.callButton.addEventListener("click",function(){if(null==s&&t(),null==s)return void alert("Could not find teacher's phone number in contacts");var e=s.replace(/[^0-9]/g,"");Ti.Platform.openURL("tel:"+e)}),i.emailButton.addEventListener("click",function(){if(null==d&&t(),null==s)return void alert("Could not find teacher's email address in contacts");var e=Ti.UI.createEmailDialog();e.subject="Hello",e.toRecipients=[d],e.open()});var I=Titanium.Network.createHTTPClient();I.onload=function(){if(200===this.status){httpResponse=this.responseText;var e="havemsg='",t=httpResponse.indexOf(e),o=httpResponse.substring(t),n=o.indexOf(";"),r=o.substring(e.length,n);Ti.API.info(r),i.districtAnnouncementsLabel.text="District Announcement:\n"+r}else Ti.API.info("Unexpected HTTP response: "+this.status),alert("Unexpected HTTP response: "+this.status)},I.onerror=function(e){Ti.API.debug(e.error),alert("error")},I.open("GET","http://www.sbschools.org"),I.send(),_.extend(i,o)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;