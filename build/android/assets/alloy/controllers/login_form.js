function Controller(){function e(){if(0!=a()){var e=Alloy.createController("ProgressIndicator",{message:"Login in progress.."}).getView();e.open(),s.buttonLogin.enabled=!1,Cloud.Users.login({login:s.inputUsername.value,password:s.inputPassword.value},function(i){if(i.success)s.activityIndicator.hide(),i.users[0],Ti.App.Properties.setString("ACS-StoredSessionId",Cloud.sessionId),Ti.App.Properties.setBool("LoggedIn",!0),loginLabel="SignOut",t(),s.loginForm.close();else{s.inputPassword.value="",s.inputUsername.value="",e.close();var o=Titanium.UI.createAlertDialog({title:"Login Failed",message:i.error&&i.message||JSON.stringify(i),buttonNames:["Retry","Cancel"]});o.show(),o.addEventListener("click",function(e){0==e.index?(s.loginForm.close(),h.open(Alloy.createController("login_form",{parentTab:h}).getView())):1==e.index&&s.loginForm.close()})}})}}function t(){(!Ti.App.Properties.hasProperty("ACSDeviceToken")||Ti.App.Properties.getString("ACSDeviceToken"))&&CloudPush.retrieveDeviceToken({success:function(e){Ti.App.Properties.setString("ACSDeviceToken",e.deviceToken),deviceToken=e.deviceToken,o()},error:function(){}})}function i(){h.open(Alloy.createController("Register",{parentTab:h}).getView())}function o(){CloudPush.showTrayNotification=!0,CloudPush.showTrayNotificationsWhenFocused=!0,CloudPush.focusAppOnPush=!1,CloudPush.showAppOnTrayClick=!0,CloudPush.addEventListener("callback",function(e){JSON.stringify(e);var t=JSON.parse(e.payload).android,i=Alloy.createModel("notification",{datetime:(new Date).toString(),title:t.title,message:t.alert,badge:t.badge});i.save(),notificationCollection.fetch(),notificationCollection.trigger("change")})}function l(){s.loginForm.removeEventListener("close",l),s.loginForm.removeEventListener("open",n),s.destroy(),s.loginForm.removeAllChildren(),s=null}function a(){return""==s.inputUsername.value||0==r(s.inputUsername.value)?(alert("Error:\nInvalid email or field is empty"),!1):""==s.inputPassword.value?(alert("Error:\nPassword field empty"),!1):!0}function r(e){var t=e,i=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;return testresults=i.test(t)?!0:!1}function n(){Ti.App.Properties.getBool("LoggedIn")?s.loginForm.close():s.buttonLogin.touchEnabled=!0}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="login_form",arguments[0]?arguments[0].__parentSymbol:null,arguments[0]?arguments[0].$model:null,arguments[0]?arguments[0].__itemTemplate:null;var s=this,d={},c={};s.__views.loginForm=Ti.UI.createWindow({backgroundColor:"white",id:"loginForm"}),s.__views.loginForm&&s.addTopLevelView(s.__views.loginForm),s.__views.loginView=Ti.UI.createView({top:20,id:"loginView",layout:"vertical"}),s.__views.loginForm.add(s.__views.loginView),s.__views.signinLabel=Ti.UI.createLabel({top:20,height:Ti.UI.SIZE,left:20,text:"Enter your email address, and password for this to login",font:{fontSize:12,fontWeight:"bold"},color:"blue",width:Ti.UI.SIZE,id:"signinLabel"}),s.__views.loginView.add(s.__views.signinLabel),s.__views.inputUsername=Ti.UI.createTextField({width:"80%",borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocapitalization:Ti.UI.TEXT_AUTOCAPITALIZATION_NONE,color:"black",id:"inputUsername"}),s.__views.loginView.add(s.__views.inputUsername),s.__views.inputPassword=Ti.UI.createTextField({width:"80%",borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,autocapitalization:Ti.UI.TEXT_AUTOCAPITALIZATION_NONE,color:"black",id:"inputPassword",passwordMask:"true"}),s.__views.loginView.add(s.__views.inputPassword),s.__views.buttonLogin=Ti.UI.createButton({title:"Log In",backgroundColor:"#336699",top:20,width:"80%",left:"10%",height:Ti.UI.SIZE,font:{fontSize:12,fontWeight:"bold"},color:"white",borderColor:"#336699",borderRadius:8,id:"buttonLogin"}),s.__views.loginView.add(s.__views.buttonLogin),s.__views.registerLabel=Ti.UI.createLabel({top:20,height:Ti.UI.SIZE,left:20,text:"Don't have an account to Login? Signup by clicking Signup button.\nYou can receive Alerts, Updates and Push Notifications.\n We don't share any of the information with third parties ",font:{fontSize:12,fontWeight:"bold"},color:"blue",width:Ti.UI.SIZE,id:"registerLabel"}),s.__views.loginView.add(s.__views.registerLabel),s.__views.buttonSignup=Ti.UI.createButton({title:"Sign Up",backgroundColor:"#336699",top:20,width:"80%",left:"10%",height:Ti.UI.SIZE,font:{fontSize:12,fontWeight:"bold"},color:"white",borderColor:"#336699",borderRadius:8,id:"buttonSignup"}),s.__views.loginView.add(s.__views.buttonSignup),i?s.__views.buttonSignup.addEventListener("click",i):c["$.__views.buttonSignup!click!openRegistration"]=!0,s.__views.activityIndicator=Ti.UI.createActivityIndicator({height:Ti.UI.SIZE,width:Ti.UI.SIZE,top:20,style:Ti.UI.ActivityIndicatorStyle.PLAIN,id:"activityIndicator"}),s.__views.loginView.add(s.__views.activityIndicator),d.destroy=function(){},_.extend(s,s.__views);var u=arguments[0]||{},h=u.parentTab;s.loginForm.title="Login",s.inputUsername.hintText="email address",s.inputPassword.hintText="Password",s.buttonLogin.title="SignIn",s.inputUsername.value=Ti.App.Properties.getString("username")?Ti.App.Properties.getString("username"):"",s.buttonLogin.addEventListener("click",e),s.loginForm.addEventListener("focus",n),s.loginForm.addEventListener("close",l),c["$.__views.buttonSignup!click!openRegistration"]&&s.__views.buttonSignup.addEventListener("click",i),_.extend(s,d)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;