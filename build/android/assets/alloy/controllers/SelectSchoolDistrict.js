function Controller(){function e(e){for(var t=[],i=0;e.files.length>i;i++){var o=e.files[i],l=o.name.split("."),a=l[1],r=l[0];if("db"===a){var s=Ti.UI.createTableViewRow({layout:"vertical",left:"1%",height:80,width:"98%",backgroundColor:"#336699",borderWidth:8,borderColor:"gray"}),d=Ti.UI.createView({layout:"hoizontal",top:0,left:0,height:Ti.UI.SIZE,width:Ti.UI.SIZE}),_=Ti.UI.createLabel({top:0,text:r,textAlight:Ti.UI.TEXT_ALIGNMENT_LEFT,left:100,height:80,width:Ti.UI.SIZE,font:{fontSize:16,fontWeight:"bold"},color:"white"}),w=Ti.UI.createSwitch({top:0,textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,height:80,left:20,value:!1,filename:r,fileid:o.id,fileurl:o.url,lastupdated:o.updated_at});w.setStyle(Ti.UI.Android.SWITCH_STYLE_CHECKBOX),w.addEventListener("change",function(e){e.value&&(c=e.source.filename,u=e.source.fileurl,h=e.source.lastupdated),n.dialog.show()}),d.add(w),d.add(_),s.add(d),t.push(s)}}return t}function t(){var e="SELECT * FROM contacts";Alloy.Globals.contacts.deleteAll();var t=schoolDB.execute(e);if(t.getRowCount()>0){for(;t.isValidRow();){var i=t.fieldByName("id"),o=t.fieldByName("name"),l=t.fieldByName("title"),a=t.fieldByName("department"),r=t.fieldByName("building"),n=t.fieldByName("phonenum"),s=t.fieldByName("ext"),d=t.fieldByName("emailaddr"),c=Alloy.createModel("contacts",{id:i,name:o,title:l,department:a,building:r,phonenum:n,ext:s,emailaddr:d});Alloy.Globals.contacts.add(c),t.next()}t.close(),Alloy.Globals.contacts.saveAll()}}function i(){var e="SELECT * FROM schools";Alloy.Globals.school.config.columns,Alloy.Globals.school.deleteAll();var t=schoolDB.execute(e);if(t.getRowCount()>0){for(;t.isValidRow();){var i=Alloy.createModel("school",{earlyreleasehours:t.fieldByName("earlyreleasehours"),delayedhours:t.fieldByName("delayedhours"),regularhours:t.fieldByName("regularhours"),name:t.fieldByName("name"),shortname:t.fieldByName("shortname"),type:t.fieldByName("type"),principal:t.fieldByName("principal"),principal_emailaddr:t.fieldByName("principal_emailaddr"),assistantprincipal:t.fieldByName("assistantprincipal"),assistantprincipal_emailaddr:t.fieldByName("assistantprincipal_emailaddr"),antibullyingspecialist:t.fieldByName("antibullyingspecialist"),antibullyingspecialist_emailaddr:t.fieldByName("antibullyingspecialist_emailaddr"),websiteurl:t.fieldByName("websiteurl"),imagefile:t.fieldByName("imagefile"),logofile:t.fieldByName("logofile"),address1:t.fieldByName("address1"),address2:t.fieldByName("address2"),city:t.fieldByName("city"),state:t.fieldByName("state"),zipcode:t.fieldByName("zipcode"),phone:t.fieldByName("phone"),fax:t.fieldByName("fax"),longitude:t.fieldByName("longitude"),latitude:t.fieldByName("latitude"),id:t.fieldByName("id")});Alloy.Globals.school.add(i),t.next()}t.close(),Alloy.Globals.school.saveAll()}}function o(){n.selectSchoolDistrict.removeEventListener("close",o),n.destroy(),c=null,u=null,h=null,n.selectSchoolDistrict.removeAllChildren(),n=null}function l(){var e=c+".zip";Cloud.Files.query({where:{name:e}},function(e){if(e.success)if(e.files.length>0){var t=e.files[0];r(t)}else a();else n.selectSchoolDistrict.close()})}function a(){n.selectSchoolDistrict.removeAllChildren();var e=Ti.UI.createAlertDialog({message:"Please Reopen the Application",ok:"OK",title:"Configuration Complete!"});e.addEventListener("click",function(){n.selectSchoolDistrict.close()}),e.show()}function r(e){var t=Alloy.createController("ProgressIndicator",{message:"Setting up configuration for \n"+c}).getView();t.open();var i=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"images");i.exists()||i.createDirectory();var o=Ti.Filesystem.getFile(i.resolve(),"tempImages.zip"),l=Ti.Network.createHTTPClient();l.onload=function(){o.write(this.responseData),require("ti.compression").unzip(i.resolve(),o.resolve(),!0),t.close(),o.deleteFile(),a()},l.open("GET",e.url),l.send()}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="SelectSchoolDistrict",arguments[0]?arguments[0].__parentSymbol:null,arguments[0]?arguments[0].$model:null,arguments[0]?arguments[0].__itemTemplate:null;var n=this,s={};n.__views.selectSchoolDistrict=Ti.UI.createWindow({backgroundColor:"#fff",id:"selectSchoolDistrict",fullscreen:"true",exitOnClose:"true"}),n.__views.selectSchoolDistrict&&n.addTopLevelView(n.__views.selectSchoolDistrict),n.__views.hintView=Ti.UI.createView({top:0,height:"20%",id:"hintView",backgroundColor:"#ffffff"}),n.__views.selectSchoolDistrict.add(n.__views.hintView),n.__views.hintLabel=Ti.UI.createLabel({top:0,left:"1%",height:80,width:"98%",font:{fontSize:14,fontWeight:"bold"},color:"blue",text:"Currently the following School Districts are supported. Select yours.",id:"hintLabel"}),n.__views.hintView.add(n.__views.hintLabel);var d=[];d.push("Confirm"),d.push("Exit"),n.__views.dialog=Ti.UI.createOptionDialog({options:d,id:"dialog",title:"Confirm School District"}),s.destroy=function(){},_.extend(n,n.__views),arguments[0]||{};var c=null,u=null,h=null;n.dialog.addEventListener("click",function(e){if(2>e.index)if(0==e.index){var o=Alloy.createController("ProgressIndicator",{message:"Loading configuration for \n"+c}).getView();o.open();var a=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"databases");a.exists()||a.createDirectory();var r=Ti.Filesystem.getFile(a.resolve(),"schoolDB.sqlite"),n=Ti.Network.createHTTPClient();n.onload=function(){r.write(this.responseData),o.close(),schoolDB=Ti.Database.install(r.getNativePath(),"schoolDBDownloaded"),t(),i(),Ti.App.Properties.setBool("dbinstalled",!0),Ti.App.Properties.setString("dbversion",h),Ti.App.Properties.setString("dbname",c+".db"),Ti.App.Properties.setString("UserSchoolDistrict",c),r.deleteFile(),l()},n.open("GET",u),n.send()}else 1==e.index&&(c=null,u=null,h=null)}),n.selectSchoolDistrict.addEventListener("close",o),n.selectSchoolDistrict.title="Select Your School District",Cloud.Files.query({page:1,per_page:20},function(t){if(t.success){var i=e(t),o=Titanium.UI.createTableView({data:i,width:"90%",top:"20%",height:Ti.UI.SIZE,separatorColor:"#000000"});n.selectSchoolDistrict.add(o)}}),_.extend(n,s)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;