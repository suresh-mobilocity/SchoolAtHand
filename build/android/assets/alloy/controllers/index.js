function Controller(){function e(){var e=Ti.UI.createEmailDialog();e.subject="School@Hand user feedback",e.toRecipients=["mobilocityinc@gmail.com"],e.open()}function t(){}function i(e){e.open(Alloy.createController("AboutSHApp",{parentTab:e}).getView())}function o(){var e=Ti.UI.createEmailDialog();e.subject="Try School@Hand Mobile App I like it",e.messageBody="Hello , \nI am using School@Hand Android App. I thought it would be useful to you too. \nYou can download School@Hand by clicking this link. \n https://play.google.com/store/apps/details?id=com.mobilocity.schoolathand\n",e.open()}function a(e){e.open(Alloy.createController("ChangeSettings",{parentTab:e}).getView())}function l(){var e="",t="SELECT value FROM enum where name like 'phoneno'",i=schoolDB.execute(t);return i.getRowCount()>0&&i.isValidRow()&&(e=i.fieldByName("value")),i.close(),e}function r(){var e="",t="SELECT value FROM enum where name like 'website'",i=schoolDB.execute(t);return i.getRowCount()>0&&i.isValidRow()&&(e=i.fieldByName("value")),i.close(),e}function n(){var e="",t="SELECT value FROM enum where name like 'location'",i=schoolDB.execute(t);return i.getRowCount()>0&&i.isValidRow()&&(e=i.fieldByName("value")),i.close(),e}function s(){var e=0,t=Ti.UI.createView({layout:"vertical",top:"63%",height:"35%",width:"95%",backgroundColor:"#33B5E5",borderColor:"white",borderWidth:1,borderRadius:8});notificationCollection.fetch({query:"SELECT * FROM notifications ORDER BY notificationid desc"});var i=notificationCollection.length,o=Ti.UI.createView({layout:"horizontal",left:0,height:Ti.UI.SIZE,width:"100%",borderColor:"white",borderSize:1,borderRadius:8}),a=Ti.UI.createLabel({top:2,left:"1%",text:i,font:{fontSize:16,fontWeight:"bold"},height:30,width:"10%",backgroundColor:"orange",borderRadius:8,color:"white",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER}),l=Ti.UI.createLabel({top:2,left:"2%",text:"Recent Notifications",font:{fontSize:16,fontWeight:"bold"},height:30,width:"70%",color:"white",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER}),r=Ti.UI.createButton({top:2,left:"2%",title:"more",font:{fontSize:16,fontWeight:"bold"},height:30,width:"14%",backgroundColor:"orange",borderRadius:8,color:"white",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER});if(r.addEventListener("click",function(){I.dashboardTab.open(Alloy.createController("Notifications",{parentTab:I.dashboardTab}).getView())}),o.add(a),o.add(l),o.add(r),t.add(o),Ti.App.Properties.hasProperty("ACSDeviceToken")){if(i>0)for(;i>e&&2>e;){var n=notificationCollection.at(e).get("datetime"),s=notificationCollection.at(e).get("message"),d=Ti.UI.createImageView({left:5,image:"/images/push_msg_icon.png",height:32,width:32}),c=Ti.UI.createView({height:Ti.UI.SIZE,width:Ti.UI.FILL,borderColor:"white",borderWidth:1}),_=Ti.UI.createLabel({top:0,left:50,text:n,font:{fontSize:14,fontWeight:"normal"},height:30,width:Ti.UI.SIZE,color:"blue",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT}),u=Ti.UI.createLabel({top:32,left:50,text:s,font:{fontSize:14,fontWeight:"normal"},height:30,width:Ti.UI.SIZE,color:"blue",textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT});c.add(d),c.add(_),c.add(u),t.add(c),e++}}else{t.add(notRegisteredLabel);var h=Ti.UI.createButton({top:5,left:"80%",title:"SignIn",font:{fontSize:12,fontWeight:"bold"},height:30,width:50,backgroundColor:"orange",borderRadius:8,color:"white",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER});h.addEventListener("click",function(){I.dashboardTab.open(Alloy.createController("login_form",{parentTab:I.dashboardTab}).getView())}),t.add(h)}return t}function d(){var e=Ti.UI.createView({layout:"vertical",top:"2%",height:"28%",width:"62%",left:"2%",backgroundColor:"#33B5E5"}),t=Ti.UI.createLabel({text:"Welcome !",font:{fontSize:14,fontWeight:"bold"},textAlign:Ti.UI.TEXT_ALIGNMENT_LEFT,height:Ti.UI.SIZE,width:Ti.UI.SIZE,left:"2%",top:0,color:"orange"}),i=Ti.UI.createLabel({top:"1%",left:"2%",width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:"white",font:{fontSize:14,fontWeight:"normal"},text:Ti.App.Properties.getString("UserSchoolDistrict")+" Schools.",borderRadius:8}),o=Ti.UI.createView({left:0,layout:"horizontal",height:Ti.UI.SIZE,width:"100%"});JSON.parse('{ "address1": "341 black horse lane", "city": "North Brunswick", "name": "district office" }');var a=Ti.UI.createButton({top:"5%",left:0,color:"white",backgroundColor:"#33B5E5",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"AppIcons",fontSize:"40dp"},title:Alloy.Globals.icons.phone,textAlign:"center",data:l()});a.addEventListener("click",function(e){Ti.Platform.openURL("tel:"+e.source.data)});var s=Ti.UI.createButton({top:"5%",left:"5%",color:"white",backgroundColor:"#33B5E5",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"AppIcons",fontSize:"40dp"},title:Alloy.Globals.icons.globe_alt,textAlign:"center",data:r()});s.addEventListener("click",function(e){var t={parentTab:I.dasboardTab,wintitle:"District Web Site",url:e.source.data};I.dashboardTab.open(Alloy.createController("ViewWebSite",t).getView())});var d=Ti.UI.createButton({top:"5%",bottom:"2%",color:"white",left:"5%",backgroundColor:"#33B5E5",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"AppIcons",fontSize:"40dp"},title:Alloy.Globals.icons.direction,textAlign:"center",data:JSON.parse(n())});return d.addEventListener("click",function(e){var t=Alloy.createController("MapDetail",{data:e.source.data});I.dashboardTab.open(t.getView())}),o.add(a),o.add(s),o.add(d),e.add(t),e.add(i),e.add(o),e}function c(){var e=Ti.App.Properties.getString("UserSchoolDistrict"),t=e.split(" - "),i=t[0],o=t[1],a=require("weatherview"),l=a.fillWeatherReport(i,o);return l}function u(){I.dashboardTab.open(Alloy.createController("SelectSchoolDistrict",{parentTab:I.dashboardTab}).getView())}function h(){I.dashboardTab.open(Alloy.createController("AppDisclaimer",{parentTab:I.dashboardTab}).getView())}function w(e){e.open(Alloy.createController("AppDisclaimerSigned",{parentTab:e}).getView())}function p(){var e=Ti.App.Properties.getString("dbname");Ti.App.Properties.getString("dbversion");var t=null;return schoolDB||(schoolDB=Ti.Database.open("schoolDBDownloaded")),Cloud.Files.query({where:{name:e}},function(e){if(e.success){for(var i=0;e.files.length>i;i++)e.files[i];if(Ti.App.Properties.getString("dbversion")==e.files[0].updated_at);else{t=Alloy.createController("ProgressIndicator",{message:"Checking for updates.."}).getView(),t.open();var o=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"databases");o.exists()||o.createDirectory();var a=Ti.Filesystem.getFile(o.resolve(),"schooldatabase.sqlite"),l=Ti.Network.createHTTPClient();l.onload=function(){a.write(this.responseData),t.fireEvent("close"),schoolDB&&schoolDB.remove(),schoolDB=Ti.Database.install(a.getNativePath(),"schoolDBDownloaded"),Ti.App.Properties.setString("dbversion",e.files[0].updated_at),m(),g(),a.deleteFile()},l.open("GET",e.files[0].url),l.send()}}}),t=null,!0}function f(){Cloud.Users.logout(function(e){e.success?(I.dashboardMainView.removeAllChildren(),noProfileLabel&&(noProfileLabel=!1),I.dashboardMain.fireEvent("open")):alert("Error:\n"+(e.error&&e.message||JSON.stringify(e)))})}function v(){I.dashboardMainView.removeAllChildren(),I.dashboardMainView.add(d()),I.dashboardMainView.add(c());var e=Titanium.UI.createScrollView({layout:"horizontal",contentWidth:"auto",contentHeight:"auto",horizontalWrap:!1,showVerticalScrollIndicator:!1,showHorizontalScrollIndicator:!0,top:"30%",height:"30%",width:"95%",backgroundColor:"white",borderRadius:8}),t=profileCollection.length;if(t>0){Ti.App.Properties.hasProperty("noUserProfilesLabelSet")&&Ti.App.Properties.removeProperty("noUserProfilesLabelSet");for(var i=0;profileCollection.length>i;){var o=profileCollection.at(i),a=o.get("profile_id"),l=o.get("url"),r=Ti.UI.createView({top:5,left:5,layout:"vertical",backgroundColor:"#33B5E5",height:Ti.UI.SIZE,width:Ti.UI.SIZE,borderRadius:8,id:a}),n=Ti.UI.createImageView({top:5,height:100,width:100,image:l,autorotate:!0,id:a}),_=Ti.UI.createLabel({top:5,text:o.get("name"),font:{fontSize:14,fontWeight:"bold"},height:Ti.UI.SIZE,width:Ti.UI.SIZE,color:"orange"});r.add(n),r.add(_),n.addEventListener("click",function(e){var t=Alloy.createController("MyDashboard",{parentTab:I.dashboardTab,$model:e.source.id,data:profileCollection.get(e.source.id)});I.dashboardTab.open(t.getView())}),e.add(r),i++}I.dashboardMainView.add(e)}else if(0==noProfileLabel){var u=Ti.UI.createView({top:5,left:5,layout:"vertical",backgroundColor:"#33B5E5",height:Ti.UI.SIZE,width:Ti.UI.SIZE,borderRadius:8,id:a}),n=Ti.UI.createButton({top:5,height:100,width:100,title:"Add Profile",backgroundColor:"gray"}),_=Ti.UI.createLabel({top:5,text:"Name",font:{fontSize:14,fontWeight:"bold"},height:Ti.UI.SIZE,width:Ti.UI.SIZE,color:"orange"});n.addEventListener("click",function(){I.dashboardTab.open(Alloy.createController("AddProfile",I.dashboardTab).getView())}),u.add(n),u.add(_),e.add(u),I.dashboardMainView.add(e),Ti.App.Properties.setString("noUserProfilesLabelSet","true"),noProfileLabel=!0}Ti.App.Properties.hasProperty("ACS-StoredSessionId")&&null!=Ti.App.Properties.getString("ACS-StoredSessionId")?Cloud.Users.showMe(function(e){e.success?(e.users[0],Ti.App.Properties.setBool("LoggedIn",!0)):Ti.App.Properties.setBool("LoggedIn",!1)}):Ti.App.Properties.setBool("LoggedIn",!1),I.dashboardMainView.add(s()),I.dashboardMain.setVisible(!0)}function m(){var e="SELECT * FROM contacts";Alloy.Globals.contacts.deleteAll();var t=schoolDB.execute(e);if(t.getRowCount()>0){for(;t.isValidRow();){var i=t.fieldByName("id"),o=t.fieldByName("name"),a=t.fieldByName("title"),l=t.fieldByName("department"),r=t.fieldByName("building"),n=t.fieldByName("phonenum"),s=t.fieldByName("ext"),d=t.fieldByName("emailaddr"),c=Alloy.createModel("contacts",{id:i,name:o,title:a,department:l,building:r,phonenum:n,ext:s,emailaddr:d});Alloy.Globals.contacts.add(c),t.next()}t.close(),Alloy.Globals.contacts.saveAll()}}function g(){var e="SELECT * FROM schools";Alloy.Globals.school.config.columns,Alloy.Globals.school.deleteAll();var t=schoolDB.execute(e);if(t.getRowCount()>0){for(;t.isValidRow();){var i=Alloy.createModel("school",{earlyreleasehours:t.fieldByName("earlyreleasehours"),delayedhours:t.fieldByName("delayedhours"),regularhours:t.fieldByName("regularhours"),name:t.fieldByName("name"),shortname:t.fieldByName("shortname"),type:t.fieldByName("type"),principal:t.fieldByName("principal"),principal_emailaddr:t.fieldByName("principal_emailaddr"),assistantprincipal:t.fieldByName("assistantprincipal"),assistantprincipal_emailaddr:t.fieldByName("assistantprincipal_emailaddr"),antibullyingspecialist:t.fieldByName("antibullyingspecialist"),antibullyingspecialist_emailaddr:t.fieldByName("antibullyingspecialist_emailaddr"),websiteurl:t.fieldByName("websiteurl"),imagefile:t.fieldByName("imagefile"),logofile:t.fieldByName("logofile"),address1:t.fieldByName("address1"),address2:t.fieldByName("address2"),city:t.fieldByName("city"),state:t.fieldByName("state"),zipcode:t.fieldByName("zipcode"),phone:t.fieldByName("phone"),fax:t.fieldByName("fax"),longitude:t.fieldByName("longitude"),latitude:t.fieldByName("latitude"),id:t.fieldByName("id")});Alloy.Globals.school.add(i),t.next()}t.close(),Alloy.Globals.school.saveAll()}}function b(){CloudPush.showTrayNotification=!0,CloudPush.showTrayNotificationsWhenFocused=!0,CloudPush.focusAppOnPush=!1,CloudPush.showAppOnTrayClick=!0,CloudPush.addEventListener("callback",function(e){JSON.stringify(e);var t=JSON.parse(e.payload).android,i=Alloy.createModel("notification",{datetime:(new Date).toLocaleString(),title:t.title,message:t.alert,badge:t.badge});i.save(),notificationCollection.fetch(),notificationCollection.trigger("change"),notificationCollection.trigger("sync")}),CloudPush.addEventListener("trayClickLaunchedApp",function(){}),CloudPush.addEventListener("trayClickFocusedApp",function(){})}function y(){I.dashboardMain.animate({left:0,duration:200}),1==isMenuWindowOpen&&(I.tabGroup.remove(menuWindow),isMenuWindowOpen=!1)}function T(){I.dashboardMain.removeEventListener("close",T),I.destroy(),I.dashboardMain.removeAllChildren(),I=null}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="index",arguments[0]?arguments[0].__parentSymbol:null,arguments[0]?arguments[0].$model:null,arguments[0]?arguments[0].__itemTemplate:null;var I=this,A={},S=[];I.__views.dashboardMain=Ti.UI.createWindow({backgroundColor:"#000",id:"dashboardMain",title:"Dashboard"}),I.__views.dashboardMainView=Ti.UI.createView({id:"dashboardMainView",backgroundColor:"#33B5E5"}),I.__views.dashboardMain.add(I.__views.dashboardMainView),I.__views.dashboardTab=Ti.UI.createTab({window:I.__views.dashboardMain,id:"dashboardTab",title:"Home"}),S.push(I.__views.dashboardTab),I.__views.__alloyId92=Alloy.createController("DistrictTab",{id:"__alloyId92"}),S.push(I.__views.__alloyId92.getViewEx({recurse:!0})),I.__views.__alloyId93=Alloy.createController("SchoolsTab",{id:"__alloyId93"}),S.push(I.__views.__alloyId93.getViewEx({recurse:!0})),I.__views.__alloyId95=Alloy.createController("MyProfiles",{id:"__alloyId95"}),S.push(I.__views.__alloyId95.getViewEx({recurse:!0})),I.__views.__alloyId96=Alloy.createController("ResourcesTab",{id:"__alloyId96"}),S.push(I.__views.__alloyId96.getViewEx({recurse:!0})),I.__views.tabGroup=Ti.UI.createTabGroup({tabs:S,id:"tabGroup"}),I.__views.tabGroup&&I.addTopLevelView(I.__views.tabGroup),A.destroy=function(){},_.extend(I,I.__views),menuOptionsTable.addEventListener("click",function(l){var r=I.tabGroup.getActiveTab(),n=r.getWindow();switch(n.animate({left:0,duration:200}),I.tabGroup.remove(menuWindow),isMenuWindowOpen=!1,!0){case"SignIn"===l.rowData.title:I.tabGroup.activeTab.open(Alloy.createController("login_form",{parentTab:I.tabGroup.activeTab}).getView());break;case"SignOut"===l.rowData.title:f();break;case"Options"===l.rowData.title:a(I.tabGroup.activeTab);break;case"Feedback"===l.rowData.title:e();break;case"Help"===l.rowData.title:t();break;case"About"===l.rowData.title:i(I.tabGroup.activeTab);break;case"Privacy Policy"===l.rowData.title:w(I.tabGroup.activeTab);break;case"Refer to a friend"===l.rowData.title:o(I.tabGroup.activeTab)}}),I.tabGroup.addEventListener("open",function(){var e=I.tabGroup.activity;Alloy.Globals.Android.Api>=11&&(e.actionBar.title="School@Hand",e.actionBar.displayHomeAsUp=!0,e.actionBar.onHomeIconItemSelected=function(){},e.onCreateOptionsMenu=function(e){var t=e.menu.add({icon:"images/action_settings.png",showAsAction:Ti.Android.SHOW_AS_ACTION_COLLAPSE_ACTION_VIEW|Ti.Android.SHOW_AS_ACTION_ALWAYS});t.addEventListener("click",function(){if(Ti.API.info("In menuItem event listener"),1==isMenuWindowOpen){for(var e=I.tabGroup.getTabs(),t=0;e.length>t;t++)e[t].getWindow().animate({left:0,duration:100});var i=I.tabGroup.getActiveTab(),o=i.getWindow();o.animate({left:0,duration:200}),I.tabGroup.remove(menuWindow),isMenuWindowOpen=!1}else{loginLabel=Ti.App.Properties.getBool("LoggedIn")?"SignOut":"SignIn";var i=I.tabGroup.getActiveTab(),o=i.getWindow(),a=[{title:loginLabel,height:50,textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,color:"black"},{title:"Options",height:50,textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,color:"black"},{title:"Privacy Policy",height:50,textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,color:"black"},{title:"Help",height:50,textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,color:"black"},{title:"Feedback",height:50,textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,color:"black"},{title:"About",height:50,textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,color:"black"},{title:"Refer to a friend",height:50,textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,color:"black"}];menuOptionsTable.data=a,menuView.add(menuOptionsTable),menuWindow.add(menuView),I.tabGroup.add(menuWindow),o.animate({left:150,duration:400}),menuWindow.show(),isMenuWindowOpen=!0}})})}),I.dashboardMain.addEventListener("open",function(){Ti.App.Properties.hasProperty("AppDisclaimerAccepted")&&"false"!=Ti.App.Properties.getString("AppDisclaimerAccepted")||h(),"true"==Ti.App.Properties.getString("AppDisclaimerAccepted")&&(Ti.App.Properties.hasProperty("UserSchoolDistrict")||u(),Ti.App.Properties.hasProperty("UserSchoolDistrict")&&Ti.App.Properties.hasProperty("dbinstalled")&&p()&&(isTabsDisabledTabs&&I.tabGroup.remove(disableTabsImage),v()))}),I.dashboardMain.addEventListener("focus",function(){var e=profileCollection.length;Ti.App.Properties.hasProperty("noUserProfilesLabelSet")&&e>0&&v()}),I.dashboardTab.addEventListener("close",function(){I.tabGroup.fireEvent("close")}),I.dashboardTab.addEventListener("click",function(){y()}),I.dashboardTab.addEventListener("close",T),I.tabGroup.addEventListener("close",function(){}),b(),Ti.App.addEventListener("close",function(){var e=Ti.Android.currentActivity;e.finish()}),tabGroupGlobalReference=I.tabGroup,I.tabGroup.open(),_.extend(I,A)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;